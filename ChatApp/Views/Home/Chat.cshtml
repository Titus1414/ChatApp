@using System.Diagnostics
@{
    Layout = null;
    string url = "https://cdn.jsdelivr.net/npm/@aspnet/signalr@1.0.0-rc1-update1/dist/browser/signalr.min.js";
}

<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

<link href="~/css/ChatStyle.css" rel="stylesheet">
<input id="SessionValue" hidden value="@ViewBag.SessionValue" />
<input id="CheckAvail" hidden value="" />
<input id="SessionName" hidden value="@ViewBag.SessionName" />
<input id="SessionImage" hidden value="@ViewBag.SessionImage" />
<div class="container-fluid">
    <div class="panel messages-panel">
        <div class="contacts-list">
            <div class="inbox-categories">
                <div data-toggle="tab" data-target="#inbox" id="InboxChat"> Inbox </div>
                <div data-toggle="tab" data-target="#sent" id="ArchiveChat"> Archive </div>
                <div data-toggle="tab" data-target="#marked" id="BlockChat"> Block </div>
                @*<div data-toggle="tab" data-target="#drafts"> Drafts </div>*@
            </div>
            <div class="tab-content">
                <div id="inbox" class="contacts-outter-wrapper tab-pane active">
                    <form class="panel-search-form info form-group has-feedback no-margin-bottom" style="margin-top:5px">
                        <input type="text" class="form-control" name="search" placeholder="Search">
                        <span class="fa fa-search form-control-feedback" style="margin-top:10px"></span>
                    </form>
                    <div class="contacts-outter" id="inboxusers">
                        <ul class="list-unstyled contacts">
                            @foreach (var item in @ViewBag.Inbox)
                            {
                                <li data-toggle="tab" data-target="@item.Id" id="OpenChat" class="">
                                    @if (@item.ChatCount > 0)
                                    {
                                        <div id="msgCnt"> 
                                        <div class="message-count"> @item.ChatCount </div>
                                        </div>
                                    }
                                    <img alt="" class="img-circle medium-image" src="@item.Image">

                                    <div class="vcentered info-combo">
                                        <h3 class="no-margin-bottom name"> @item.UserName </h3>
                                        <h5> @item.LastMessage </h5>
                                    </div>
                                    <div class="contacts-add">
                                        @{
                                            DateTime dt = (new DateTime(1970, 1, 1)).AddMilliseconds(double.Parse(item.Date.ToString()));
                                            var ds = dt.ToString("dd HH mm");
                                        }
                                        <span class="message-time"> @ds </span>
                                        <i class="fa fa-thin fa-ban" data-target="@item.Id" id="addBlock" style="position: absolute;font-size: 14px;right: 12px;bottom: 15px;color: #ed9696;cursor: pointer;"></i>
                                        <i class="fa fa-paperclip" data-target="@item.Id" id="addArchive"></i>
                                    </div>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
                <div id="sent" class="contacts-outter-wrapper tab-pane">
                    <form class="panel-search-form success form-group has-feedback no-margin-bottom">
                        <input type="text" class="form-control" name="search" placeholder="Search">
                        <span class="fa fa-search form-control-feedback" style="margin-top:10px"></span>
                    </form>
                    <div class="contacts-outter" id="Archiveusers">
                        <ul class="list-unstyled contacts success">
                            @foreach (var item in @ViewBag.Archive)
                            {
                                <li data-toggle="tab" id="OpenChat" data-target="@item.Id">
                                    @if (@item.ChatCount > 0)
                                    {
                                        <div class="message-count"> @item.ChatCount </div>
                                    }
                                    <img alt="" class="img-circle medium-image" src="@item.Image">

                                    <div class="vcentered info-combo">
                                        <h3 class="no-margin-bottom name"> @item.UserName </h3>
                                        <h5> @item.LastMessage </h5>
                                    </div>
                                    <div class="contacts-add">
                                        @{
                                            DateTime dt = (new DateTime(1970, 1, 1)).AddMilliseconds(double.Parse(item.Date.ToString()));
                                            var ds = dt.ToString("dd HH mm");
                                        }
                                        <span class="message-time"> @ds </span>
                                        <i class="fa fa-thin fa-ban" data-target="@item.Id" id="addBlockArchive" style="position: absolute;font-size: 14px;right: 12px;bottom: 15px;color: #ed9696;cursor: pointer;"></i>
                                        <i class="fa fa-paperclip" data-target="@item.Id" id="removeArchive"></i>
                                    </div>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
                <div id="marked" class="contacts-outter-wrapper tab-pane">
                    <form class="panel-search-form warning form-group has-feedback no-margin-bottom">
                        <input type="text" class="form-control" name="search" placeholder="Search">
                        <span class="fa fa-search form-control-feedback" style="margin-top:10px"></span>
                    </form>
                    <div class="contacts-outter" id="blockusers">
                        <ul class="list-unstyled contacts warning">
                            @foreach (var item in @ViewBag.Block)
                            {
                                <li data-toggle="tab" id="OpenChat" data-target="@item.Id">
                                    @if (@item.ChatCount > 0)
                                    {
                                        <div class="message-count"> @item.ChatCount </div>
                                    }
                                    <img alt="" class="img-circle medium-image" src="@item.Image">

                                    <div class="vcentered info-combo">
                                        <h3 class="no-margin-bottom name"> @item.UserName </h3>
                                        <h5> @item.LastMessage </h5>
                                    </div>
                                    <div class="contacts-add">
                                        @{
                                            DateTime dt = (new DateTime(1970, 1, 1)).AddMilliseconds(double.Parse(item.Date.ToString()));
                                            var ds = dt.ToString("dd HH mm");
                                        }
                                        <span class="message-time"> @ds </span>
                                        <i class="fa fa-thin fa-ban" data-target="@item.Id" id="removeBlock" style="position: absolute;font-size: 14px;right: 12px;bottom: 15px;color: #ed9696;cursor: pointer;"></i>
                                        <i class="fa fa-paperclip" data-target="@item.Id" id="addArchive"></i>
                                    </div>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
                @*<div id="drafts" class="contacts-outter-wrapper tab-pane">
                    <form class="panel-search-form dark form-group has-feedback no-margin-bottom">
                    <input type="text" class="form-control" name="search" placeholder="Search">
                    <span class="fa fa-search form-control-feedback"></span>
                    </form>
                    <div class="contacts-outter">
                    <ul class="list-unstyled contacts dark">
                    <li data-toggle="tab" data-target="#draft-message-1">
                    <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                    <div class="vcentered info-combo">
                    <h3 class="no-margin-bottom name"> Milla Shiffman </h3>
                    <h5> Hello, Mila, can you send me the latest pack of icons, I need </h5>
                    </div>
                    <div class="contacts-add">
                    <span class="message-time"> 4:22 <sup>AM</sup></span>
                    <i class="fa fa-trash-o"></i>
                    <i class="fa fa-paperclip"></i>
                    </div>
                    </li>
                    </ul>
                    </div>
                    </div>*@
            </div>
        </div>

        <div class="tab-content">
            <div class="tab-pane message-body active" id="inbox-message-1">
                <div class="message-top">
                    <a class="btn btn btn-success new-message"> <i class="fa fa-envelope"></i> New Message </a>

                    <div class="new-message-wrapper">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Send message to...">
                            <a class="btn btn-danger close-new-message" href="#"><i class="fa fa-times"></i></a>
                        </div>

                        <div class="chat-footer new-message-textarea">
                            <textarea class="send-message-text"></textarea>
                            <label class="upload-file">
                                <input type="file" required="">
                                <i class="fa fa-paperclip"></i>
                            </label>
                            <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                        </div>
                    </div>
                </div>

                <div class="message-chat">

                    <div class="chat-body" id="GetChatHere">
                    </div>

                    <div class="chat-footer">
                        <textarea class="send-message-text" id="MessageSended"></textarea>
                        <label class="upload-file">
                            <input type="file" required="">
                            <i class="fa fa-paperclip"></i>
                        </label>
                        <button type="button" id="btnSend" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                    </div>
                </div>
            </div>

            @*<div class="tab-pane message-body" id="inbox-message-2">
                <div class="message-top">
                <a class="btn btn btn-success new-message"> <i class="fa fa-envelope"></i> New Message </a>

                <div class="new-message-wrapper">
                <div class="form-group">
                <input type="text" class="form-control" placeholder="Send message to...">
                <a class="btn btn-danger close-new-message" href="#"><i class="fa fa-times"></i></a>
                </div>

                <div class="chat-footer new-message-textarea">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                </div>

                <div class="message-chat">
                <div class="chat-body">
                <div class="message info">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> Mark Zuckerberg </h4>
                <h5> <i class="fa fa-clock-o"></i> 3:45 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hi, Dennis. How's it going with your latest project?
                </div>
                </div>
                <br>
                </div>

                <div class="message my-message">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-body-inner">
                <div class="message-info">
                <h4> Dennis Novac </h4>
                <h5> <i class="fa fa-clock-o"></i> 3:52 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hello. It's going well, thanks, but I may need your help tomorrow evening. Will you be available ?
                </div>
                </div>
                </div>
                <br>
                </div>

                <div class="message info">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> Mark Zuckerberg </h4>
                <h5> <i class="fa fa-clock-o"></i> 3:56 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Of course, just call me before that, in case I forget.
                </div>
                </div>
                <br>
                </div>

                <div class="message my-message">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-body-inner">
                <div class="message-info">
                <h4> Dennis Novac </h4>
                <h5> <i class="fa fa-clock-o"></i> 4:01 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Great, thank you.
                </div>
                </div>
                </div>
                <br>
                </div>

                </div>

                <div class="chat-footer">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                        </div>

                        <div class="tab-pane message-body" id="inbox-message-3">
                <div class="message-top">
                <a class="btn btn btn-success new-message"> <i class="fa fa-envelope"></i> New Message </a>

                <div class="new-message-wrapper">
                <div class="form-group">
                <input type="text" class="form-control" placeholder="Send message to...">
                <a class="btn btn-danger close-new-message" href="#"><i class="fa fa-times"></i></a>
                </div>

                <div class="chat-footer new-message-textarea">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                </div>

                <div class="message-chat">
                <div class="chat-body">
                <div class="message info">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> Evan Williams </h4>
                <h5> <i class="fa fa-clock-o"></i> 5:07 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hey, you asked for my feedback, it's brilliant. Damn, I envy you I didn't come up with something this good :D Keep it up, man, it's going to be very popular. Trust me !
                </div>
                </div>
                <br>
                </div>

                <div class="message my-message">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-body-inner">
                <div class="message-info">
                <h4> Dennis Novac </h4>
                <h5> <i class="fa fa-clock-o"></i> 5:16 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Wow, thanks. You'll be my main template tester from now on :)
                </div>
                </div>
                </div>
                <br>
                </div>

                <div class="message info">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> Evan Williams </h4>
                <h5> <i class="fa fa-clock-o"></i> 5:21 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                I'm all in, as long as you continue to make such great templates.
                </div>
                </div>
                <br>
                </div>

                </div>

                <div class="chat-footer">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                        </div>

                        <div class="tab-pane message-body" id="inbox-message-4">
                <div class="message-top">
                <a class="btn btn btn-success new-message"> <i class="fa fa-envelope"></i> New Message </a>

                <div class="new-message-wrapper">
                <div class="form-group">
                <input type="text" class="form-control" placeholder="Send message to...">
                <a class="btn btn-danger close-new-message" href="#"><i class="fa fa-times"></i></a>
                </div>

                <div class="chat-footer new-message-textarea">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                </div>

                <div class="message-chat">
                <div class="chat-body">
                <div class="message info">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> Jonahtan Ive </h4>
                <h5> <i class="fa fa-clock-o"></i> 6:12 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                I'm coming to your place at 9 pm and I hope you'll have those tasty brownies again :)
                </div>
                </div>
                <br>
                </div>

                <div class="message my-message">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-body-inner">
                <div class="message-info">
                <h4> Dennis Novac </h4>
                <h5> <i class="fa fa-clock-o"></i> 6:16 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Ye, I still have a bag full of them.
                </div>
                </div>
                </div>
                <br>
                </div>

                <div class="message info">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> Jonahtan Ive </h4>
                <h5> <i class="fa fa-clock-o"></i> 6:12 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Great, we have a lot of work to do and we need fuel :D
                </div>
                </div>
                <br>
                </div>
                <div class="message info">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> Jonahtan Ive </h4>
                <h5> <i class="fa fa-clock-o"></i> 6:13 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                And invite Daniel too, please.
                </div>
                </div>
                <br>
                </div>

                </div>

                <div class="chat-footer">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                        </div>

                        <div class="tab-pane message-body" id="sent-message-1">
                <div class="message-top">
                <a class="btn btn btn-success new-message"> <i class="fa fa-envelope"></i> New Message </a>

                <div class="new-message-wrapper">
                <div class="form-group">
                <input type="text" class="form-control" placeholder="Send message to...">
                <a class="btn btn-danger close-new-message" href="#"><i class="fa fa-times"></i></a>
                </div>

                <div class="chat-footer new-message-textarea">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                </div>

                <div class="message-chat">
                <div class="chat-body">

                <div class="message my-message">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-body-inner">
                <div class="message-info">
                <h4> Dennis Novac </h4>
                <h5> <i class="fa fa-clock-o"></i> 2:05 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hi, I've just finished the stickers you wanted. I'll send them to you in an archive in 10 minutes.
                </div>
                </div>
                </div>
                <br>
                </div>

                <div class="message success">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> David Beckham </h4>
                <h5> <i class="fa fa-clock-o"></i> 2:11 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hello, Dennis. Thanks. Also how's it going with our latest football website. Do you need any additional help or information?
                </div>
                </div>
                <br>
                </div>

                <div class="message success">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> David Beckham </h4>
                <h5> <i class="fa fa-clock-o"></i> 2:24 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                I would like to take a look at it this evening, is it possible ?
                </div>
                </div>
                <br>
                </div>

                <div class="message my-message">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-body-inner">
                <div class="message-info">
                <h4> Dennis Novac </h4>
                <h5> <i class="fa fa-clock-o"></i> 2:25 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                It's going well, no need for any other help, thanks. Sure, send me a message when you'll be ready.
                </div>
                </div>
                </div>
                <br>
                </div>

                </div>

                <div class="chat-footer">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                        </div>

                        <div class="tab-pane message-body" id="sent-message-2">
                <div class="message-top">
                <a class="btn btn btn-success new-message"> <i class="fa fa-envelope"></i> New Message </a>

                <div class="new-message-wrapper">
                <div class="form-group">
                <input type="text" class="form-control" placeholder="Send message to...">
                <a class="btn btn-danger close-new-message" href="#"><i class="fa fa-times"></i></a>
                </div>

                <div class="chat-footer new-message-textarea">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                </div>

                <div class="message-chat">
                <div class="chat-body">

                <div class="message my-message">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-body-inner">
                <div class="message-info">
                <h4> Dennis Novac </h4>
                <h5> <i class="fa fa-clock-o"></i> 12:36 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hi, can you please test my new template Dauphin and tell me if you like it ?
                </div>
                </div>
                </div>
                <br>
                </div>

                <div class="message success">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> Jeff Williams </h4>
                <h5> <i class="fa fa-clock-o"></i> 12:41 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hello, Dennis. I will take a look at it tomorrow, because I'm already fed up with the current project.
                </div>
                </div>
                <br>
                </div>

                <div class="message my-message">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-body-inner">
                <div class="message-info">
                <h4> Dennis Novac </h4>
                <h5> <i class="fa fa-clock-o"></i> 12:46 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Thanks :)
                </div>
                </div>
                </div>
                <br>
                </div>

                </div>

                <div class="chat-footer">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                        </div>

                        <div class="tab-pane message-body" id="marked-message-1">
                <div class="message-top">
                <a class="btn btn btn-success new-message"> <i class="fa fa-envelope"></i> New Message </a>

                <div class="new-message-wrapper">
                <div class="form-group">
                <input type="text" class="form-control" placeholder="Send message to...">
                <a class="btn btn-danger close-new-message" href="#"><i class="fa fa-times"></i></a>
                </div>

                <div class="chat-footer new-message-textarea">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                </div>

                <div class="message-chat">
                <div class="chat-body">
                <div class="message warning">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> Jessica Fresco </h4>
                <h5> <i class="fa fa-clock-o"></i> 1:44 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hello, Dennis. I wanted to let you know we reviewed your proposal and decided you'll start working together with our UI/UX team on Tuesday, January 10th, 2017. Congratulations and thank you!
                </div>
                </div>
                <br>
                </div>

                <div class="message my-message">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-body-inner">
                <div class="message-info">
                <h4> Dennis Novac </h4>
                <h5> <i class="fa fa-clock-o"></i> 1:51 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hello, great news. I'm sure we're going to make something amazing together!
                </div>
                </div>
                </div>
                <br>
                </div>

                </div>

                <div class="chat-footer">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                        </div>

                        <div class="tab-pane message-body" id="marked-message-2">
                <div class="message-top">
                <a class="btn btn btn-success new-message"> <i class="fa fa-envelope"></i> New Message </a>

                <div class="new-message-wrapper">
                <div class="form-group">
                <input type="text" class="form-control" placeholder="Send message to...">
                <a class="btn btn-danger close-new-message" href="#"><i class="fa fa-times"></i></a>
                </div>

                <div class="chat-footer new-message-textarea">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                </div>

                <div class="message-chat">
                <div class="chat-body">
                <div class="message warning">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> Pavel Durov </h4>
                <h5> <i class="fa fa-clock-o"></i> 3:23 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hey, we need your help for our next Telegram re-design. Are you available to talk about this tomorrow evening at around 8 PM ?
                </div>
                </div>
                <br>
                </div>

                <div class="message my-message">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-body-inner">
                <div class="message-info">
                <h4> Dennis Novac </h4>
                <h5> <i class="fa fa-clock-o"></i> 3:31 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hello, yes I will. It's always a pleasure to work with you and your team :)
                </div>
                </div>
                </div>
                <br>
                </div>

                <div class="message warning">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-info">
                <h4> Pavel Durov </h4>
                <h5> <i class="fa fa-clock-o"></i> 3:35 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Perfect, talk to you tomorrow evening.
                </div>
                </div>
                <br>
                </div>

                </div>

                <div class="chat-footer">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                        </div>

                        <div class="tab-pane message-body" id="draft-message-1">
                <div class="message-top">
                <a class="btn btn btn-success new-message"> <i class="fa fa-envelope"></i> New Message </a>

                <div class="new-message-wrapper">
                <div class="form-group">
                <input type="text" class="form-control" placeholder="Send message to...">
                <a class="btn btn-danger close-new-message" href="#"><i class="fa fa-times"></i></a>
                </div>

                <div class="chat-footer new-message-textarea">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                </div>

                <div class="message-chat">
                <div class="chat-body">

                <div class="message my-message">
                <img alt="" class="img-circle medium-image" src="https://bootdey.com/img/Content/avatar/avatar1.png">

                <div class="message-body">
                <div class="message-body-inner">
                <div class="message-info">
                <h4> Dennis Novac </h4>
                <h5> <i class="fa fa-clock-o"></i> 4:22 PM </h5>
                </div>
                <hr>
                <div class="message-text">
                Hello, Mila, can you send me the latest pack of icons, I need all the source files. Thanks.
                </div>
                </div>
                </div>
                <br>
                </div>

                </div>

                <div class="chat-footer">
                <textarea class="send-message-text"></textarea>
                <label class="upload-file">
                <input type="file" required="">
                <i class="fa fa-paperclip"></i>
                </label>
                <button type="button" class="send-message-button btn-info"> <i class="fa fa-send"></i> </button>
                </div>
                </div>
                        </div>*@
        </div>
    </div>
</div>
<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="@url"></script>
<script>

        $(document).on('click', '#btnSend', function () {
                    debugger
                            var chatid = $("#CheckAvail").val();
                    var toid = $("#CheckAvail").val();
                    var message = $("#MessageSended").val();
                    var name = $("#userName").val();
                    if(name == null) name = $("#SessionName").val();
                    var image = $("#ImageSrc").val();
                    if(image == null) image = $("#SessionImage").val();
                    var d = new Date(new Date().getTime()).toLocaleTimeString();
                    var time = d;//(d.getHours() + d.getMinutes() + d.getSeconds()).tostring();
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("SendMessage", "Home")',
                            data: { 'chatid': chatid, 'toid': toid, 'message': message },
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                if(data == "Success")
                                {
                                    var mySecondDiv=$('<div class="message my-message"> <img class="img-circle medium-image" src='+ image +'> <div class="message-body"> <div class="message-body-inner"> <div class="message-info"> <h4> ' + name + ' </h4> <h5> <i class="fa fa-clock-o"></i> ' + time + ' </h5></div><hr> <div class="message-text"> ' + message + ' </div></div> </div> <br> </div>');
                                    $('#GetChatHere').append(mySecondDiv);
                                    document.getElementById('GetChatHere').scrollTop = document.getElementById('GetChatHere').scrollHeight;
                                    $("#MessageSended").val("");
                                }
                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })

                });

                $(function () {
        $("#MessageSended").keypress(function (e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            //alert(code);
            if (code == 13) {
                var chatid = $("#CheckAvail").val();
                    var toid = $("#CheckAvail").val();
                    var message = $("#MessageSended").val();
                    var name = $("#userName").val();
                    if(name == null) name = $("#SessionName").val();
                    var image = $("#ImageSrc").val();
                    if(image == null) image = $("#SessionImage").val();
                    var d = new Date(new Date().getTime()).toLocaleTimeString();
                    var time = d;//(d.getHours() + d.getMinutes() + d.getSeconds()).tostring();
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("SendMessage", "Home")',
                            data: { 'chatid': chatid, 'toid': toid, 'message': message },
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                if(data == "Success")
                                {
                                    var mySecondDiv=$('<div class="message my-message"> <img class="img-circle medium-image" src='+ image +'> <div class="message-body"> <div class="message-body-inner"> <div class="message-info"> <h4> ' + name + ' </h4> <h5> <i class="fa fa-clock-o"></i> ' + time + ' </h5></div><hr> <div class="message-text"> ' + message + ' </div></div> </div> <br> </div>');
                                    $('#GetChatHere').append(mySecondDiv);
                                    document.getElementById('GetChatHere').scrollTop = document.getElementById('GetChatHere').scrollHeight;
                                    $("#MessageSended").val("");
                                }
                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })
            }
        });
    });

                $(document).on('click', '#OpenChat', function () {
                    debugger
                    var val = $(this).attr("data-target");
                    $("#CheckAvail").val(val);
                    $("#ToId").val(val);
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("ChatModal", "Home")',
                            data: { 'id': val },
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                //$('#exampleModal').modal('show');
                                $("#GetChatHere").html("");
                                $("#GetChatHere").html(data);
                                document.getElementById('GetChatHere').scrollTop = document.getElementById('GetChatHere').scrollHeight;
                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })

                });


            $(document).on('mouseover', '#focusMsg',function() {
                var val = $(this).attr("data-target");
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("FocusMessage", "Home")',
                            data: { 'id': val },
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                if(data == "Success")
                                {
                                }
                                //$('#exampleModal').modal('show');

                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })
            });

            $(document).on('click', '#addArchive', function () {
                    debugger
                    var val = $(this).attr("data-target");
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("ArchiveChat", "Home")',
                            data: { 'id': val, 'check': "Archive" },
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                $("#inboxusers").html("");
                                $("#inboxusers").html(data);
                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })

                });
                $(document).on('click', '#removeArchive', function () {
                    debugger
                    var val = $(this).attr("data-target");
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("ArchiveChat", "Home")',
                            data: { 'id': val, 'check': "Unarchive" },
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                $("#Archiveusers").html("");
                                $("#Archiveusers").html(data);
                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })

                });
                $(document).on('click', '#addBlock', function () {
                    debugger
                    var val = $(this).attr("data-target");
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("BlockChats", "Home")',
                            data: { 'id': val, 'check': "Block" },
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                $("#inboxusers").html("");
                                $("#inboxusers").html(data);
                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })
                });
                $(document).on('click', '#addBlockArchive', function () {
                    debugger
                    var val = $(this).attr("data-target");
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("BlockChats", "Home")',
                            data: { 'id': val, 'check': "BlockArchive" },
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                $("#Archiveusers").html("");
                                $("#Archiveusers").html(data);
                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })
                });
                $(document).on('click', '#removeBlock', function () {
                    debugger
                    var val = $(this).attr("data-target");
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("BlockChats", "Home")',
                            data: { 'id': val, 'check': "Unblock" },
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                $("#blockusers").html("");
                                $("#blockusers").html(data);
                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })
                });
                //InboxChat
                $(document).on('click', '#InboxChat', function () {
                    debugger
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("InboxChat", "Home")',
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                //$('#exampleModal').modal('show');
                                $("#inboxusers").html("");;
                                $("#inboxusers").html(data);
                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })

                });
                //ArchiveChat
                $(document).on('click', '#ArchiveChat', function () {
                    debugger
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("ArchiveChats", "Home")',
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                //$('#exampleModal').modal('show');
                                $("#Archiveusers").html("");
                                $("#Archiveusers").html(data);
                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })

                });
                //BlockChat
                $(document).on('click', '#BlockChat', function () {
                    debugger
                        $.ajax({
                            type: 'post',
                            url: '@Url.Action("BlockChat", "Home")',
                            contenttype: 'application/json; charset=utf-8',
                            async: true,
                            success: function (data) {
                                debugger
                                //$('#exampleModal').modal('show');
                                $("#blockusers").html("");
                                $("#blockusers").html(data);
                            },
                            error: function (xhr) {
                                alert('error');
                            }
                    })

                });
                var sess = $("#SessionValue").val();
                const connection = new signalR.HubConnectionBuilder()
            .configureLogging(signalR.LogLevel.Debug)
            //.withUrl("https://localhost:44303/Chat", options)
            .withUrl("https://localhost:7046/Chat?token="+sess+"")
            .configureLogging(signalR.LogLevel.Information)
            .build();
        connection.start().then(() => {
        });

        connection.on("ReceiveMessage", (Id,message,image,Name,chatid) => {
        debugger
            var val = $("#CheckAvail").val();
            if(chatid == val)
            {
              var d = new Date(new Date().getTime()).toLocaleTimeString();
              var time = d;
                  $('#GetChatHere').append('<div class="message info" id="focusMsg" data-target="' + Id + '">' +
                  '<img alt="" class="img-circle medium-image" src="' + image + '"> <div class="message-body">' +
                  '<div class="message-info"> <h4> '+ Name + ' </h4> <h5> <i class="fa fa-clock-o"></i> ' + time + ' </h5> ' +
                  '</div> <hr> <div class="message-text"> ' + message + ' </div> </div> <br> </div>');
            }
            document.getElementById('GetChatHere').scrollTop = document.getElementById('GetChatHere').scrollHeight;

        });

</script>